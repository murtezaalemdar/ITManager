{% extends "base.html" %}

{% block title %}ITManager | Yönetim{% endblock %}

{% block container_class %}container-fluid p-0{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg dash-navbar">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2 text-white" href="/dashboard">
      <span class="brand-badge bg-white text-primary">IT</span>
      <span class="fw-bold">ITManager</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link text-white-50" href="/dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link text-white-50" href="/devices">Cihazlar</a></li>
        <li class="nav-item"><a class="nav-link text-white-50 active" href="/admin/users">Yönetim</a></li>
      </ul>
      <div class="d-flex align-items-center gap-2">
        <div class="small text-white-50">Kullanıcı: <span class="text-white fw-semibold">{{ user }}</span></div>
        <a class="btn btn-sm btn-danger" href="/logout">Çıkış</a>
      </div>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}
<style>
  .dash-navbar {
    background: linear-gradient(135deg, rgba(var(--bs-primary-rgb), .92), rgba(var(--bs-info-rgb), .70) 55%, rgba(var(--bs-success-rgb), .55));
    border-bottom: 1px solid rgba(255, 255, 255, .18);
  }
  .dash-navbar .navbar-toggler {
    border-color: rgba(255, 255, 255, .35);
  }
  .dash-navbar .navbar-toggler-icon {
    filter: invert(1);
  }
</style>

<div class="container py-4">
  <h1 class="h4 mb-3">Yönetim</h1>

  {% if err %}
    <div class="alert alert-danger">{{ err }}</div>
  {% endif %}
  {% if ok %}
    <div class="alert alert-success">{{ ok }}</div>
  {% endif %}

  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card">
        <div class="card-header fw-semibold">Kullanıcılar</div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped mb-0">
              <thead>
                <tr>
                  <th>Kullanıcı</th>
                  <th>Admin</th>
                </tr>
              </thead>
              <tbody>
                {% for u in users %}
                <tr>
                  <td class="mono">{{ u.username }}</td>
                  <td>
                    {% if u.is_admin %}
                      <span class="badge text-bg-primary">Evet</span>
                    {% else %}
                      <span class="badge text-bg-secondary">Hayır</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card mb-3">
        <div class="card-header fw-semibold">Yeni Kullanıcı Ekle</div>
        <div class="card-body">
          <form method="post" action="/admin/users/create" class="vstack gap-2">
            <div>
              <label class="form-label">Kullanıcı adı</label>
              <input class="form-control" name="username" autocomplete="username" required />
            </div>
            <div>
              <label class="form-label">Parola</label>
              <input class="form-control" name="password" type="password" autocomplete="new-password" required />
              <div class="form-text">En az 8 karakter.</div>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="on" id="is_admin" name="is_admin" />
              <label class="form-check-label" for="is_admin">Admin yetkisi ver</label>
            </div>
            <div>
              <button class="btn btn-primary" type="submit">Kullanıcı oluştur</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="card-header fw-semibold">Admin Parolası Değiştir ({{ user }})</div>
        <div class="card-body">
          <form method="post" action="/admin/password" class="vstack gap-2">
            <div>
              <label class="form-label">Mevcut parola</label>
              <input class="form-control" name="current_password" type="password" autocomplete="current-password" required />
            </div>
            <div>
              <label class="form-label">Yeni parola</label>
              <input class="form-control" name="new_password" type="password" autocomplete="new-password" required />
              <div class="form-text">En az 8 karakter.</div>
            </div>
            <div>
              <button class="btn btn-warning" type="submit">Parolayı güncelle</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
